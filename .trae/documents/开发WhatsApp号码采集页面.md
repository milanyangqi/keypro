# 开发WhatsApp号码采集页面

## 1. 功能需求分析
根据用户需求，需要开发一个完整的WhatsApp号码采集页面，具备以下核心功能：
- 地区选择（下拉菜单）
- 关键词输入
- 采集来源选择（预设网站列表）
- 自动采集流程
- 实时采集进度和状态显示
- 采集结果表格展示
- 导出为Excel/CSV功能
- 响应式布局
- 加载状态和错误处理

## 2. 技术方案

### 2.1 前端实现
重写现有的 `WhatsAppNumberCollection.tsx` 文件，实现以下功能模块：

#### 2.1.1 采集配置表单
- 地区选择：使用下拉菜单，支持常用国家和地区
- 关键词输入：支持多行输入，可输入多个关键词
- 采集来源选择：支持多选，包含预设网站列表
- 采集页数设置：支持自定义采集页数
- 开始采集按钮：触发采集流程

#### 2.1.2 采集过程管理
- 采集状态显示：显示采集进度、已采集号码数量
- 实时日志展示：显示采集过程中的关键步骤
- 暂停/继续/停止功能：控制采集过程
- 错误处理机制：显示采集过程中的错误信息

#### 2.1.3 采集结果展示
- 表格展示：显示采集到的WhatsApp号码、来源网站、采集时间等信息
- 筛选功能：支持按地区、关键词、来源网站筛选
- 分页功能：支持分页查看大量采集结果
- 复制功能：支持复制单个号码或全部号码

#### 2.1.4 导出功能
- 支持导出为Excel格式
- 支持导出为CSV格式
- 支持导出筛选后的结果
- 导出进度显示

#### 2.1.5 响应式设计
- 适配桌面端、平板和移动设备
- 移动端优化的表单布局
- 表格在移动端的自适应显示

### 2.2 后端实现
需要新增以下API接口：

#### 2.2.1 采集配置相关
- 获取预设网站列表
- 获取支持的地区列表

#### 2.2.2 采集控制接口
- 开始采集：接收采集配置，返回采集任务ID
- 暂停采集：接收任务ID，暂停采集
- 继续采集：接收任务ID，继续采集
- 停止采集：接收任务ID，停止采集

#### 2.2.3 采集状态和结果接口
- 获取采集状态：接收任务ID，返回采集进度、已采集数量等
- 获取采集结果：接收任务ID，返回采集到的号码列表
- 获取采集日志：接收任务ID，返回采集过程日志

#### 2.2.4 导出接口
- 导出采集结果：接收任务ID和导出格式，返回导出文件URL

## 3. 实现步骤

### 3.1 前端实现步骤
1. 重写 `WhatsAppNumberCollection.tsx` 文件，设计新的页面结构
2. 实现采集配置表单组件
3. 实现采集过程管理组件
4. 实现采集结果表格组件
5. 实现导出功能组件
6. 添加响应式设计
7. 添加加载状态和错误处理

### 3.2 后端实现步骤
1. 设计采集任务数据模型
2. 实现采集配置相关接口
3. 实现采集控制接口
4. 实现采集状态和结果接口
5. 实现导出接口
6. 集成采集引擎（或模拟采集功能）

## 4. 代码结构设计

### 4.1 前端代码结构
```
WhatsAppNumberCollection.tsx
├── 采集配置表单
│   ├── 地区选择下拉框
│   ├── 关键词输入框
│   ├── 采集来源多选框
│   ├── 采集页数设置
│   └── 开始采集按钮
├── 采集过程管理
│   ├── 采集状态显示
│   ├── 实时日志展示
│   ├── 暂停/继续/停止按钮
│   └── 已采集数量统计
├── 采集结果展示
│   ├── 表格展示
│   ├── 筛选功能
│   ├── 分页功能
│   └── 复制功能
└── 导出功能
    ├── Excel导出按钮
    ├── CSV导出按钮
    └── 导出进度显示
```

### 4.2 后端代码结构
```
backend/src/controllers/
└── whatsapp-collection.ts  # 新增采集控制器
    ├── getWebsites          # 获取预设网站列表
    ├── getRegions           # 获取支持的地区列表
    ├── startCollection      # 开始采集
    ├── pauseCollection      # 暂停采集
    ├── resumeCollection     # 继续采集
    ├── stopCollection       # 停止采集
    ├── getCollectionStatus  # 获取采集状态
    ├── getCollectionResults # 获取采集结果
    ├── getCollectionLogs    # 获取采集日志
    └── exportResults        # 导出采集结果

backend/src/routes/
└── whatsapp-collection.ts  # 新增采集路由

backend/src/models/
└── CollectionTask.ts       # 新增采集任务模型
```

## 5. 关键技术点

### 5.1 前端技术点
- 使用React Hooks管理状态和副作用
- 使用Ant Design组件库实现UI
- 使用WebSocket或轮询实现实时采集状态更新
- 使用xlsx库实现Excel导出
- 使用CSS媒体查询实现响应式设计

### 5.2 后端技术点
- 使用Express框架实现API接口
- 使用MongoDB存储采集任务和结果
- 集成采集引擎（如Puppeteer、Cheerio等）
- 实现异步任务处理
- 实现文件导出功能

## 6. 测试和优化

### 6.1 功能测试
- 测试采集配置表单的有效性验证
- 测试采集过程的状态管理
- 测试采集结果的准确性
- 测试导出功能的正确性

### 6.2 性能测试
- 测试大量采集结果的表格渲染性能
- 测试导出功能的性能
- 测试响应式布局在不同设备上的表现

### 6.3 优化方向
- 优化表格渲染性能，使用虚拟列表
- 优化导出功能，支持大数据量导出
- 优化采集过程，支持并行采集
- 优化UI交互，提高用户体验

## 7. 预期成果

通过本计划的实施，将开发出一个功能完整、性能优良、用户体验良好的WhatsApp号码采集页面，满足用户的需求。该页面将具备以下特点：
- 直观易用的采集配置界面
- 实时的采集状态和进度显示
- 清晰的采集结果展示
- 便捷的导出功能
- 良好的响应式设计
- 完善的错误处理机制

这个页面将帮助用户更高效地采集WhatsApp号码，提高工作效率。